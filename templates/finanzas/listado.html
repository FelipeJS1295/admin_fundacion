{% extends "layouts/base.html" %}
{% block content %}
{% set titulo = (scope == 'banco' and 'Banco' or 'Caja chica') ~ ' — ' ~ (tipo|capitalize) %}

<header class="mb-4 flex items-center justify-between">
  <h1 class="text-xl font-semibold text-white">{{ titulo }}</h1>
  <a href="/finanzas/{{ scope }}/{{ tipo }}/nuevo"
     class="px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500 text-white text-sm">
     + Nuevo
  </a>
</header>

<!-- FILTROS -->
<form method="get" class="mb-4 grid grid-cols-1 md:grid-cols-6 gap-3">
  <input type="hidden" name="scope" value="{{ scope }}">
  <input type="hidden" name="tipo" value="{{ tipo }}">

  <div>
    <label class="block text-xs text-slate-400 mb-1">Desde</label>
    <input type="date" name="desde" value="{{ filtro.desde or '' }}"
           class="w-full rounded-lg border border-white/10 bg-slate-900/70 px-3 py-2 text-slate-100">
  </div>

  <div>
    <label class="block text-xs text-slate-400 mb-1">Hasta</label>
    <input type="date" name="hasta" value="{{ filtro.hasta or '' }}"
           class="w-full rounded-lg border border-white/10 bg-slate-900/70 px-3 py-2 text-slate-100">
  </div>

  <div>
    <label class="block text-xs text-slate-400 mb-1">Categoría</label>
    <select name="categoria_id"
            class="w-full rounded-lg border border-white/10 bg-slate-900/70 px-3 py-2 text-slate-100">
      <option value="">Todas</option>
      {% for c in categorias %}
        <option value="{{ c.id }}" {{ 'selected' if filtro.categoria_id == c.id else '' }}>
          {{ c.nombre }}
        </option>
      {% endfor %}
    </select>
  </div>

  {% if scope == 'banco' %}
  <div>
    <label class="block text-xs text-slate-400 mb-1">Método</label>
    <select name="metodo"
            class="w-full rounded-lg border border-white/10 bg-slate-900/70 px-3 py-2 text-slate-100">
      <option value="">Todos</option>
      {% for m in ['debito','credito','transferencia','caja_vecina','otro'] %}
        <option value="{{ m }}" {{ 'selected' if filtro.metodo == m else '' }}>{{ m }}</option>
      {% endfor %}
    </select>
  </div>
  {% endif %}

  <div class="md:col-span-2">
    <label class="block text-xs text-slate-400 mb-1">Buscar (concepto)</label>
    <div class="flex gap-2">
      <input name="q" value="{{ filtro.q or '' }}"
             class="flex-1 rounded-lg border border-white/10 bg-slate-900/70 px-3 py-2 text-slate-100"
             placeholder="Ej: donación, transferencia, útiles...">
      <button class="px-4 rounded-lg bg-slate-700 hover:bg-slate-600 text-white">Filtrar</button>
      <a href="/finanzas/{{ scope }}/{{ tipo }}"
         class="px-3 rounded-lg border border-white/10 text-slate-300 hover:bg-slate-800/50">
         Limpiar
      </a>
    </div>
  </div>
</form>

<!-- LISTADO -->
<div class="rounded-xl border border-white/10 bg-slate-900/60 p-4">
  <div class="mb-4 text-slate-300">
    Total {{ tipo }}:
    <span class="font-semibold text-white">{{ total|clp }}</span>
  </div>

  <div class="overflow-x-auto">
    <table class="min-w-full text-sm text-slate-200">
      <thead class="text-slate-400">
        <tr>
          <th class="px-3 py-2 text-left">Fecha</th>
          {% if scope == 'banco' %}
            <th class="px-3 py-2 text-left">Método</th>
          {% endif %}
          <th class="px-3 py-2 text-left">Concepto</th>
          <th class="px-3 py-2 text-left">N° Doc</th>
          <th class="px-3 py-2 text-right">Monto</th>
          <th class="px-3 py-2 text-right">Acciones</th>
        </tr>
      </thead>

      <tbody>
        {% for i in items %}
          <tr class="border-t border-white/5 hover:bg-slate-800/40">
            <td class="px-3 py-2">{{ i.fecha }}</td>
            {% if scope == 'banco' %}
              <td class="px-3 py-2">{{ i.metodo_pago }}</td>
            {% endif %}
            <td class="px-3 py-2">{{ i.concepto }}</td>
            <td class="px-3 py-2">{{ i.numero_documento or '' }}</td>
            <td class="px-3 py-2 text-right">{{ i.monto|clp }}</td>
            <td class="px-3 py-2 text-right">
              <a href="/finanzas/{{ scope }}/{{ tipo }}/{{ i.id }}/editar"
                 class="inline-block px-2 py-1 rounded-md text-xs bg-sky-700 hover:bg-sky-600">
                 Editar
              </a>
              <form method="post" action="/finanzas/{{ scope }}/{{ tipo }}/{{ i.id }}/eliminar"
                    class="inline-block ml-1"
                    onsubmit="return confirm('¿Eliminar este movimiento?');">
                <button class="px-2 py-1 rounded-md text-xs bg-rose-700 hover:bg-rose-600">
                  Eliminar
                </button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="6" class="px-3 py-6 text-center text-slate-400">Sin registros</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

